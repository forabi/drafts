<h1 id="-jquery-2-jquery">تعلّم jQuery‏ (2): أساسيّات jQuery</h1>
<p>تُسهِّل مكتبة jQuery التّعامل مع محتويات صفحة HTML بعد أن يعرضها المتصفّح، وتوفّر أدوات تُساعدك في متابعة تفاعل المستخدم مع الصّفحة، وتحريك العناصر فيها، والتّواصل مع الخواديم دون إعادة تحميل الصّفحة. سنشرح هذه الأدوات بعد قليل. لنبدأ أوّلًا بالاطّلاع على أساسيّات jQuery، وكيف يمكن استخدام وظيفتها الأساسيّة: الوصول إلى عناصر مُحدَّدة في الصفحة وفعل شيءٍ ما بها.</p>
<p><em>ملاحظة: يفترض هذا الدّليل أنّك على علم بأساسيّات HTML ومُحدِّدات CSS. إن لم تكن تألف كيف يمكن استخدام مُحدّدات CSS للوصول إلى عناصر مُحدّدة في الصّفحة، فعليك أوّلًا تعلّم ذلك قبل الشروع في متابعة هذا الدّليل.</em></p>
<h2 id="-">ما هذا الرمز: <code>$</code>؟</h2>
<p>توفّر مكتبة jQuery الدّالّة <code>jQuery</code>، التي تتيح لك تحديد العناصر بمُحدّدات CSS.</p>
<pre><code class="lang-javascript">var listItems = jQuery( &#39;li&#39; );
</code></pre>
<p>إن قرأت من قبل برامج تستخدم jQuery، فلا بدّ أنّك اعتدت على هذا:</p>
<pre><code class="lang-javascript">var listItems = $( &#39;li&#39; );
</code></pre>
<p>كما ناقشنا في الجزء السّابق (أساسيّات JavaScript)، فكلّ الأسماء تكاد تكون سّليمة في JavaScript ما لم تبدأ برقم أو تحوي إشارة &quot;-&quot;. ولذا فالاسم <code>$</code> في المثال الأخير ليس إلّا اسمًا مُختصرًا للدّالّة <code>jQuery</code>، ولو اطّلعت على <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js">مصدر jQuery</a>، لقرأت هذا قرب نهايته:</p>
<pre><code class="lang-javascript">// Expose jQuery to the global object
window.jQuery = window.$ = jQuery;
</code></pre>
<p>عندما تستدعي الدّالّة ‎<code>$()</code>‎ وتمرّر لها مُحدّدًا، فإنّك تحصل على كائن jQuery جديدٍ. الدّوالّ في JavaScript هي الأخرى كائنات، وهذا يعني أنّ للدّالّة <code>$</code> (و<code>jQuery</code> بالطّبع) خصائص ووظائف أيضًا. مثلاً: يمكنك استخدام الخاصّة ‎<code>$.support</code>‎ لمعرفة ما الميزات الّتي يدعمها المتصفّح الحاليّ، كما يمكنك استخدام الوظيفة ‎<code>$.ajax</code>‎ لإرسال طلب AJAX.</p>
<p><em>ملاحظة: من الآن فصاعدًا سنستخدم <code>$</code> بدلًا من <code>jQuery</code> في هذه السّلسلة سعيًا للاختصار. لاحظ أنّه إن احتوت صفحتك أكثر من مكتبة واحدة، فقد يُستخدم الاسم <code>$</code> من مكتبة أخرى، ممّا يمنع عمل jQuery، فإن واجهتك مشكلة كهذه، جرّب استخدام <a href="http://api.jquery.com/jQuery.noConflict/"><code>jQuery.noConflict</code></a> قبل تحميل المكتبات الأخرى.</em></p>
<h2 id="-document-ready-">‏‎$(document).ready()‎</h2>
<p>قبل استخدام jQuery لفعل أيّ شيء في الصّفحة، علينا التأكّد من كون الصّفحة قد بلغت حالةً تسمح بتعديل محتوياتها. يمكن تنفيذ ذلك في jQuery بإحاطة برنامجنا ضمن دالّة ثمّ إمرار هذه الدّالة إلى ‎<code>$(document).ready()</code>‎.  كما ترى في المثال التّالي، يمكن للدّالّة الّتي نمرّرها أن تكون مجهولة (بلا اسم):</p>
<pre><code class="lang-javascript">$( document ).ready(function() {
  console.log( &#39;ready!&#39; );
});
</code></pre>
<p>هذا سيؤدّي إلى استدعاء الدّالّة الّتي مرّرناها إلى ‎<code>.ready()</code>‎ بعد أن يصبح المُستند (الصفحة) جاهزًا. ما الذي يحدث هنا؟ استخدمنا ‎<code>$(document)</code>‎ لإنشاء كائن jQuery من <code>document</code> في الصّفحة، ثمّ استدعينا الدّالّة ‎<code>.ready()</code>‎ على هذا الكائن، مُمرِّرين إليها الدّالّة الّتي نريد تنفيذها.</p>
<p>بما أنّك ستجد نفسك تُعيد كتابة هذا النّصّ مرارًا، فإنّ jQuery تقدّم لك طريقةً مُختصرةً لإنجازه، إذ تقوم الدّالّة ‎<code>$()</code>‎ بمهمّة مُختلفة عند إمرار دالّة إليها بدلًا من مُحدِّد CSS، وعندها تتصرّف وكأنّها اسم بديلٌ للوظيفة  ‎<code>$(document).ready()</code>‎:</p>
<pre><code class="lang-javascript">$(function() {
  console.log( &#39;ready!&#39; );
});
</code></pre>
<p><em>ملاحظة: من الآن فصاعدًا، سنفترض أنّ النّصوص الّتي ترد في هذه السّلسلة مُحاطة بالعبارة ‎<code>$(document).ready(function() { ... });</code>‎، وسنترك هذه العبارة بغرض الإيجاز.</em></p>
<h2 id="-">الوصول إلى العناصر</h2>
<p>أبسط ما يمكن إنجازه بـjQuery تحديد بعض العناصر ثمّ فعل شيء ما بها. إن كنت تفهم مُحدّدات CSS، فستجد أنّ الوصول إلى بعض العناصر سهل ومباشر: ليس عليك إلا إمرار المُحدِّد المناسب إلى ‎<code>$()</code>‎.</p>
<pre><code class="lang-javascript">$( &#39;#header&#39; ); // حدّد العنصر الّذي مُعرِّفه &#39;header&#39;
$( &#39;li&#39; );      // حدّد كل عناصر القوائم في الصّفحة
$( &#39;ul li&#39; );   // حدّد كل عناصر القوائم الموجودة في قوائم غير مُرتّبة
$( &#39;.person&#39; ); // حدّد كل العناصر ذات الصّنف &#39;person&#39;
</code></pre>
<p>من المهمّ أن تفهم أنّ أيّ تحديد تُجري لن يتضمّن إلّا العناصر الموافقة للمُحدّد والتي كانت موجودة في اللّحظة الّتي أجريت فيها التّحديد، بمعنى أنّك إذا كتبت ‎<code>var anchors = $( &#39;a&#39; );</code>‎ ثمّ أضفت عنصر <code>&lt;a&gt;</code> إلى الصّفحة لاحقًا، فلن تحوي <code>anchors</code> العنصر الجديد.</p>
<h3 id="-jquery">طرق أخرى لإنشاء كائن jQuery</h3>
<p>بالإضافة إلى إمرار مُحدّد بسيط إلى الدّالة ‎<code>$()</code>‎، يمكن إنشاء كائنات jQuery بطرق أخرى:</p>
<pre><code class="lang-javascript">// أنشئ كائن jQuery من عنصر DOM
$( document.body.children[0] );

// أنشئ كائن jQuery من قائمة بعناصر DOM
$( [ window, document ] );

// أجرِ التّحديد بسياق عنصر DOM
var firstBodyChild = document.body.children[0];
$( &#39;li&#39;, firstBodyChild );

// أجرِ التّحديد ضمن تحديد سابق
var paragraph = $( &#39;p&#39; );
$( &#39;a&#39;, paragraph );
</code></pre>
<h3 id="-">هل يحتوي التّحديد الّذي أجريته على أيّة عناصر؟</h3>
<p>ترغب أحيانًا في تنفيذ بعض الأوامر عندما يُطابق تحديدك عنصرًا أو أكثر فقط، ولكنّ الدّالّة ‎<code>$()</code>‎ تُعيدُ <em>دومًا</em> كائن jQuery، وهذا الكائن دائمًا صائب (truthy)، ولذا عليك فحص محتوى التّحديد لمعرفة إن كان يحوي أيّة عناصر.</p>
<p><strong>تحذير: نصّ برمجيّ غير سليم</strong></p>
<pre><code class="lang-javascript">if ( $( &#39;#nonexistent&#39; ) ) {
  // خطأ! الأوامر هنا ستُنفَّذ دومًا!
}

if ( $( &#39;#nonexistent&#39; ).length &gt; 0 ) {
  // صحيح! لن تُنفّذ الأوامر هنا إلّا إن احتوت الصّفحة على كائن مُعرّفه &#39;nonexistent&#39;
}
</code></pre>
<p>بإمكاننا اختصار هذا الفحص أكثر بالاعتماد على كون <code>0</code> قيمة خاطئة (falsy):</p>
<pre><code class="lang-javascript">if ( $( &#39;#nonexistent&#39; ).length ) {
  // لن تُنفّذ الأوامر هنا إلّا إن وجد عنصر مُطابق
}
</code></pre>
<h3 id="-">الوصول إلى عناصر مُفردة من تحديد</h3>
<p>إن كنت تحتاج التّعامل مع عنصر DOM خام من تحديد، فعليك الوصول إلى هذا العنصر من كائن jQuery. لنفترض مثلًا أنّك تريد الوصول إلى الخاصّة <code>value</code> لكائن <code>&lt;input&gt;</code> مباشرةً، عليك إذن التّعامل مع عنصر DOM الخام:</p>
<pre><code class="lang-javascript">var listItems = $( &#39;li&#39; );
var rawListItem = listItems[0]; // أو listItems.get( 0 )
var html = rawListItem.innerHTML;
</code></pre>
<p>لاحظ أنّه ليس بإمكانك استدعاء وظائف jQuery على عناصر DOM الخام، فلن يعمل المثال التّالي:</p>
<p><strong>تحذير: نصّ برمجيّ غير سليم</strong></p>
<pre><code class="lang-javascript">var listItems = $( &#39;li&#39; );
var rawListItem = listItems[0];
var html = rawListItem.html();
// Object #&lt;HTMLInputElement&gt; has no method &#39;html&#39;
</code></pre>
<p>إن أردت العمل مع عنصر مُفرد في تحديد وأردت استخدام وظائف jQuery معه، فعليك إنشاء كائن jQuery جديد انطلاقًا منه باستخدام الدّالّة  ‎<code>.eq()</code>‎، وإمرار دليل العنصر الّذي تريده:</p>
<pre><code class="lang-javascript">var listItems = $( &#39;li&#39; );
var secondListItem = listItems.eq( 1 );
secondListItem.remove();
</code></pre>
<h2 id="-">إنشاء كائنات جديدة</h2>
<p>للدّالّة <code>$</code> دورٌ ثالث أخير: إنشاء عناصر جديدة. إن مرّرت قصاصة HTML إلى <code>$()</code>‎، فستُنشئ كائنًا جديدًا في الذّاكرة، بمعنى أنّ الكائن يُنشأ ولكن لا يُضاف إلى الصّفحة إلى أن تفعل ذلك بنفسك.</p>
<pre><code class="lang-javascript">$( &#39;&lt;p&gt;&#39; ); // يُنشئ عنصر &lt;p&gt; بلا محتوى
$( &#39;&lt;p&gt;Hello!&lt;/p&gt;&#39; ); // يُنشى عنصر &lt;p&gt; فيه نصّ
$( &#39;&lt;p class=&quot;greet&quot;&gt;Hello!&lt;/p&gt;&#39; ); // يُنشى عنصر &lt;p&gt; فيه نصّ وله صنف
</code></pre>
<p>بإمكانك أيضًا إنشا عنصر جديد بإمرار كائنٍ يحوي معلومات تصف كيفيّة إنشاء العنصر:</p>
<pre><code class="lang-javascript">$( &#39;&lt;p&gt;&#39;, {
  html: &#39;Hello!&#39;,
  &#39;class&#39;: &#39;greet&#39;
});
</code></pre>
<p>لاحظ أنّه يجب أن نُحيط <code>class</code> بعلامتي اقتباس، لأنّ <code>class</code> كلمة محجوزة في JavaScript، وعدم إحاطتها بالعلامتين سيسبّب وقوع أخطاء في بعض المتصفّحات. راجع <a href="http://api.jquery.com/jQuery/#jQuery2">وثائق jQuery‏</a> لتفاصيل الخصائص المختلفة الّتي يمكنك تضمينها في هذا الكائن.</p>
<p>سنتعرّف كيف نُضيف العناصر في الصّفحة في الجزء القادم من السّلسلة، الّذي يشرح الانتقال عبر الصّفحة وتعديل محتوياتها.</p>
<h2 id="-">التّعامل مع التحديدات</h2>
<p>بعد إنشائك كائن jQuery يحوي تحديدًا، فإنّك غالبًا ما تريد فعل شيء ما به، وقبل ذلك عليك أن تتعرّف على أسلوب jQuery في التّعامل مع الكائنات.</p>
<h2 id="-">فحص تحديد</h2>
<p>بإمكاننا معرفة إن كان تحديد ما يُطابق معايير مُعيّنة باستخدام الوظيفة ‎<code>.is()</code>‎. أكثر الطّرق شيوعًا لاستخدام هذه الوظيفة تزويدها بمُحدِّد كمُعاملٍ مفرد لها، وعندها تُعيد <code>true</code> أو <code>false</code> حسب مُطابقة التّحديد للمُحدِّد:</p>
<pre><code class="lang-javascript">$( &#39;li&#39; ).eq( 0 ).is( &#39;.special&#39; ); // false
$( &#39;li&#39; ).eq( 1 ).is( &#39;.special&#39; ); // true
</code></pre>
<p>بإمكانك تمرير كائن jQuery أيضًا إلى الوظيفة ‎<code>.is()</code>‎، أو حتّى كائن DOM خام، أو حتّى دالّة لإجراء اختبار أكثر تعقيدًا إن لزم. راجع <a href="http://api.jquery.com/is/">الوثائق</a> لمزيد من التّفاصيل.</p>
<h3 id="-">وظائف القراءة والكتابة والسّرد الضّمنيّ</h3>
<p>بعد عمل التّحديد، تتوفّر وظائف عديدة يمكنك استدعاؤها. تقع هذه الوظائف عمومًا في إحدى مجموعتين: وظائف القراءة (getters) ووظائف الكتابة (setters). فالأولى تعطينا معلومات عن التّحديد، والثّانية تُغيّر التّحديد بشكل من الأشكال. وفي معظم الحالات يقتصر عمل وظائف القراءة على العنصر الأول في التّحديد (‎<code>.text()</code>‎ إحدى استثناءات هذه القاعدة)؛ أمّا وظائف الكتابة فتشمل بعملها كلّ العناصر في التّحديد، مستخدمةً ما يُعرف بالسّرد الضّمنيّ (implicit iteration).</p>
<p>معنى السّرد الضّمنيّ أنّ jQuery ستمرّ تلقائيًّا على كلّ العناصر في التّحديد عندما تستدعي وظيفة كتابة على هذا التّحديد، أيّ أنّه ليس عليك استدعاء وظيفة على كلّ عنصر في التّحديد بمفرده عندما تريد فعل شيء على كل العناصر في تحديد واحدٍ، بل اكتفِ باستدعاء هذه الوظيفة على التّحديد نفسه، وستفهم jQuery أنّ عليها تنفيذه على كلّ العناصر في التّحديد.</p>
<p>لنفترض أنّنا نريد تغيير نصّ HTML في كل عناصر القوائم في الصّفحة، ولفعل ذلك علينا استخدام الوظيفة ‎<code>.html()</code>‎ الّتي تقوم بتغيير نصّ HTML في <em>كلّ</em> عناصر القوائم المُحدّدة.</p>
<pre><code class="lang-javascript">$( &#39;li&#39; ).html( &#39;New HTML&#39; );
</code></pre>
<p>بإمكانك أيضًا إمرار دالّة إلى وظائف الكتابة في jQuery، وستُستخدم القيمة المُعادة منها باعتبارها القيمة الجديدة، وتستقبل هذه الدّالة مُعاملين اثنين: دليل العنصر (index) في التّحديد، والقيمة القديمة للشّيء الذي تحاول تغييره، وهذا مُفيد في حال احتجت معلومات عن حالة العنصر الحاليّة لتعيين حالته الجديدة بشكل صحيح.</p>
<pre><code class="lang-javascript">$( &#39;li&#39; ).html(function( index, oldHtml ) {
  return oldHtml + &#39;!!!&#39;
});
</code></pre>
<h3 id="-explicit-iteration-">السّرد الصّريح (Explicit Iteration)</h3>
<p>في بعض الأحيان، لن تلبّي وظائف jQuery الأصليّة المهمّة الّتي تريد إنجازها بدقّة، وسيكون عليك حينها المرور على العناصر في التّحديد بشكل صريح، وهذا ما تتيحه الوظيفة ‎<code>.each()</code>‎. في المثال التّالي نستخدمها لإضافة وسم <code>&lt;b&gt;</code> في بداية عنصر القائمة، يحوي دليل العنصر:</p>
<pre><code class="lang-javascript">$( &#39;li&#39; ).each(function( index, elem ) {
  // this: عنصر DOM الخام الحالي
  // index: دليل العنصر الحالي في التّحديد
  // elem: عنصر DOM الخام الحالي (مثل this)
  $( elem ).prepend( &#39;&lt;b&gt;&#39; + index + &#39;: &lt;/b&gt;&#39; );
});
</code></pre>
<p><em>ملاحظة: ستلاحظ أنّ عنصر DOM الخام مُتاح ضمن الدّالّة الّتي نُمرّرها إلى ‎<code>.each()</code>‎ بطريقتين: الأولى عبر <code>this</code> والثّانية عبر <code>elem</code>. وكما ناقشنا في الجزء السّابق (أساسيّات JavaScript)، فإنّ <code>this</code> كلمة خاصّة في JavaScript تُشير إلى الكائن الّذي يُمثّل سياق الدّالّة الحاليّ. وفي jQuery فإنّ <code>this</code> تُشير في معظم الحالات إلى عنصر DOM الخام الّذي تعمل عليه الدّالّة الحاليّة. لذا فإنّها تُشير في حالة ‎<code>.each()</code>‎ إلى العنصر الحاليّ في مجموعة العناصر الّتي نسردها.</em></p>
<h3 id="-chaining-">السَّلسَلة (Chaining)</h3>
<p>من أكثر الأمور فائدةً في jQuery إمكانيّة &quot;سَلسَلة&quot; الوظائف معًا. هذا يعني أنّ بإمكاننا استدعاء سلسِلة من الوظائف على تحديدٍ ما دون الحاجة لإعادة التّحديد أو حفظه في متغيّر. بإمكاننا حتّى إنشاء تحديدات جديدة بناء على التّحديد السّابق، دون كسر السّلسلة:</p>
<pre><code class="lang-javascript">$( &#39;li&#39; )
  .click(function() {
    $( this ).addClass( &#39;clicked&#39; );
  })
  .find( &#39;span&#39; )
    .attr( &#39;title&#39;, &#39;Hover over me&#39; );
</code></pre>
<p>الأمر ممكن لأنّ كل دالّة كتابة (setter) في jQuery تُعيد التّحديد الذي اُستدعيت لتعمل عليه. وهذا أمر عظيم الفائدة، حتّى أنّ مكتبات كثيرة اعتمدته تأثّرًا بـjQuery. ولكن يجب الحذر عند استخدامه. فالسّلاسل الطّويلة تجعل النّصّ البرمجيّة صعب القراءة والتّعديل والتنقيح لا قاعدة واضحة تفرض طولًا مناسبًا للسّلسلة، ولكن حتّى السلاسل القصيرة قد تحتاج إلى إعادة الصّياغة تسهيلًا لقراءتها.</p>
<pre><code class="lang-javascript">‎‎var listItems = $( &#39;li&#39; );
var spans = listItems.find( &#39;span&#39; );

listItems
  .click(function() {
    $( this ).addClass( &#39;clicked&#39; );
  });

spans.attr( &#39;title&#39;, &#39;Hover over me&#39; );
</code></pre>
<h2 id="-">خاتمة</h2>
<p>لدينا الآن معلومات ممتازة عن تفاصيل عمل jQuery؛ وسنستعرض في الجزء القادم كيف يمكننا تطبيق هذه المعلومات لإنجاز أشياء حقيقيّة بها!</p>

